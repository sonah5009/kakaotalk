(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[41],{183:function(e,s,a){Promise.resolve().then(a.bind(a,1816))},1816:function(e,s,a){"use strict";a.r(s);var l=a(7437),t=a(2265),r=a(2173),n=a(4033);s.default=()=>{let[e,s]=(0,t.useState)(null),[a,o]=(0,t.useState)(null),[c,i]=(0,t.useState)(""),d=(0,t.useRef)(null),m=(0,t.useCallback)(()=>{d.current&&(d.current.scrollTop=d.current.scrollHeight)},[]);function convertToReadableTime(e){let s=e.split(" ")[1],[a,l]=s.split(":"),t=parseInt(a,10)%12||12,r=12>parseInt(a,10)?"오전":"오후";return"".concat(r," ").concat(t,":").concat(l)}let u=(0,n.usePathname)(),h=(0,n.useSearchParams)(),f="".concat(u,"?").concat(h),x=function(e){let s=e.match(/\d+/);return s?s[0]:null}(f),g=(0,t.useCallback)(async()=>{try{let e=await r.Z.get("http://localhost:8000/messages",{params:{room_key:x}});o(e.data),setTimeout(m,0)}catch(e){console.error("Error fetching messages:",e)}},[x,m]),b=(0,t.useCallback)(async e=>{if(e&&e.preventDefault(),c.trim())try{let e=localStorage.getItem("user_key");s(e),await r.Z.post("http://localhost:8000/insert-message",{message:c,user_key:e,room_key:x}),i(""),await g(),setTimeout(m,0)}catch(e){console.error("Error sending message:",e)}},[c,x,g,m]),handleKeyDown=e=>{13!=e.keyCode||e.shiftKey||(e.preventDefault(),b(e))};(0,t.useEffect)(()=>{let e=localStorage.getItem("user_key");s(e),g();let a=document.getElementById("message");return a&&a.addEventListener("keydown",handleKeyDown),()=>{a&&a.removeEventListener("keydown",handleKeyDown)}},[]);let formatMessageWithBr=e=>({__html:e.replace(/\n/g,"<br>")});return(0,l.jsx)("div",{className:"flex flex-col w-full h-full overflow-scroll bg-primary-skyblue",children:(0,l.jsxs)("div",{className:"flex flex-col justify-between h-full ",children:[(0,l.jsx)("div",{className:"w-full p-3 font-bold bg-primary-skyblue/90",children:"Messages"}),(0,l.jsx)("div",{className:"h-full px-5 overflow-y-scroll",id:"background-left",ref:d,children:a&&a.length>0?(0,l.jsx)("ul",{children:a.map((s,a)=>(0,l.jsx)("li",{children:s.user_key!=e?(0,l.jsxs)("div",{className:"left-container",children:[(0,l.jsxs)("div",{className:"left-id",children:[" ",s.username]}),(0,l.jsxs)("div",{className:"chat-container",children:[(0,l.jsx)("div",{className:"break-words user-chat-box w-fit max-w-[200px] overflow-wrap color-white",dangerouslySetInnerHTML:formatMessageWithBr(s.message)}),(0,l.jsx)("div",{className:"time-box",children:convertToReadableTime(s.time_stamp)})]})]}):(0,l.jsxs)("div",{className:"chat-container line-right",children:[(0,l.jsx)("div",{className:"time-box-right",children:convertToReadableTime(s.time_stamp)}),(0,l.jsx)("div",{className:"break-words user-chat-box w-fit max-w-[200px] overflow-wrap color-yellow",dangerouslySetInnerHTML:formatMessageWithBr(s.message)})]})},a))}):(0,l.jsx)("div",{children:"No messages found."})}),(0,l.jsx)("div",{className:"rounded-t-lg h-[100px]",children:(0,l.jsxs)("form",{className:"flex flex-col items-end h-full bg-white rounded-br-sm ",children:[(0,l.jsx)("textarea",{className:"w-full border-none outline-none resize-none",name:"text",id:"message",cols:"50",rows:"10",value:c,onChange:e=>i(e.target.value),onKeyDown:handleKeyDown}),(0,l.jsx)("button",{type:"submit",className:"send-box",id:"btn_send",onSubmit:b,children:"Send"}),(0,l.jsx)("div",{className:"mb-2"})]})})]})})}}},function(e){e.O(0,[630,971,472,744],function(){return e(e.s=183)}),_N_E=e.O()}]);